function BlogService(n,t){var i=n("",{},{post_items:{method:"POST",url:"/api/post/items"},post_count:{method:"POST",url:"/api/post/count"},post_item:{method:"POST",url:"/api/post/item"},post_create:{method:"POST",url:"/api/post/create"},post_update:{method:"POST",url:"/api/post/update"},post_delete:{method:"POST",url:"/api/post/delete"},talk_items:{method:"POST",url:"/api/talk/items"},talk_count:{method:"POST",url:"/api/talk/count"}});return{post_items:function(n){var r=t.defer();return i.post_items({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_count:function(n){var r=t.defer();return i.post_count({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_item:function(n){var r=t.defer();return i.post_item({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_create:function(n){var r=t.defer();return i.post_create({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_update:function(n){var r=t.defer();return i.post_update({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_delete:function(n){var r=t.defer();return i.post_delete({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},talk_items:function(n){var r=t.defer();return i.talk_items({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},talk_count:function(n){var r=t.defer();return i.talk_count({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise}}}function PostListController(n,t){function i(t){t.status==1&&(n.posts=t.posts)}function r(t){t.status==1&&(n.totalCount=t.totalCount)}n.pageChanged=function(){var r={};r.pageIndex=n.currentPage;r.pageSize=n.pageSize;r.keyword=n.keyword;r.dataStatus=n.dataStatus;t.post_items(r).then(i)};n.keywordChanged=n.dataStatusChanged=n.mappingTypeChanged=function(){n.currentPage=1;n.refresh()};n.refresh=function(){var u={};u.pageIndex=n.currentPage;u.pageSize=n.pageSize;u.keyword=n.keyword;u.dataStatus=n.dataStatus;t.post_items(u).then(i);u={};u.keyword=n.keyword;u.dataStatus=n.dataStatus;t.post_count(u).then(r)};n.deletePostById=function(n){var i={};i.id=n;t.post_delete(i).then(post_delete_callback)};n.maxSize=10;n.currentPage=1;n.pageSize=10;n.dataStatus=0;n.refresh()}function PostNewController(n,t,i){function f(n){n.status==1&&t.go("app.post.post-list")}function r(n,t,i){var r=n.getDoc(),u=r.getCursor(),f;r.somethingSelected()?(f=r.listSelections(),f.forEach(function(n){for(var u=[n.head.line,n.anchor.line].sort(),f=u[0];f<=u[1];f++)r.replaceRange(t,{line:f,ch:0});r.setCursor({line:u[0],ch:i||0})})):(r.replaceRange(t,{line:u.line,ch:0}),r.setCursor({line:u.line,ch:i||0}));n.focus()}function u(n,t,i){var r=n.getDoc(),u=r.getCursor(),f;r.somethingSelected()?(f=r.getSelection(),r.replaceSelection(t+f+i)):(r.replaceRange(t+i,{line:u.line,ch:u.ch}),r.setCursor({line:u.line,ch:u.ch+t.length}));n.focus()}n.editorOptions={mode:"gfm",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0};n.post={};n.post.publishTime=new Date;n.openDatePicker=function(){n.isDatePickerOpen=!0};n.postBodyChanged=function(){window.searchTime!=null&&window.clearTimeout(searchTime);window.searchTime=window.setTimeout(function(){$(".md-editor-preview").html(marked(n.post.body))},200)};n.md_click_h1=function(){this.$broadcast("CodeMirror",function(n){r(n,"# ",2)})};n.md_click_h2=function(){this.$broadcast("CodeMirror",function(n){r(n,"## ",3)})};n.md_click_h3=function(){this.$broadcast("CodeMirror",function(n){r(n,"### ",4)})};n.md_click_h4=function(){this.$broadcast("CodeMirror",function(n){r(n,"### ",5)})};n.md_click_h5=function(){this.$broadcast("CodeMirror",function(n){r(n,"#### ",6)})};n.md_click_b=function(){this.$broadcast("CodeMirror",function(n){u(n,"**","**")})};n.md_click_i=function(){this.$broadcast("CodeMirror",function(n){u(n,"*","*")})};n.md_click_image=function(){this.$broadcast("CodeMirror",function(n){r(n,"![](http://)",2)})};n.md_click_link=function(){this.$broadcast("CodeMirror",function(n){u(n,"[","](http://)")})};n.md_click_blockquote=function(){this.$broadcast("CodeMirror",function(n){r(n,"> ",2)})};n.md_click_ul=function(){this.$broadcast("CodeMirror",function(n){r(n,"* ",2)})};n.md_click_ol=function(){this.$broadcast("CodeMirror",function(n){r(n,"1. ",3)})};n.md_click_code=function(){this.$broadcast("CodeMirror",function(n){n.getDoc().getSelection().indexOf("\n")>0?u(n,"```\n","\n```"):u(n,"`","`")})};n.create=function(){if(n.post.title==null||n.post.title.length==0){alert("填写文章标题");return}if(n.post.ename==null||n.post.title.ename==0){alert("填写文章路径");return}if(n.post.body==null||n.post.body.length==0){alert("请填写正文");return}var t={};t.title=n.post.title;t.ename=n.post.ename;t.body=n.post.body;t.publishTime=n.publishTime;i.post_create(t).then(f)}}function PostEditController(n,t,i,r){function f(i){i.status==404?t.go("app.post.post-list"):n.post=i.blog}function e(){console.log(result);result.status==1&&alert("success")}n.id=i.id;n.id||t.go("app.post.post-list");n.editorOptions={mode:"gfm",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0};n.postBodyChanged=function(){window.searchTime!=null&&window.clearTimeout(searchTime);window.searchTime=window.setTimeout(function(){n.post.htmlBody=marked(n.post.body);n.$apply()},200)};n.create=function(){if(n.post.title==null||n.post.title.length==0){alert("填写文章标题");return}if(n.post.ename==null||n.post.title.ename==0){alert("填写文章路径");return}if(n.post.body==null||n.post.body.length==0){alert("请填写正文");return}var t={blog:n.post,version:67890};t.id=n.post.id;t.title=n.post.title;t.ename=n.post.ename;t.body=n.post.body;r.post_update(t).then(e)};var u={};u.id=n.id;r.post_item(u).then(f)}function TalkListController(n,t){function i(t){t.status==1&&(n.talkList=t.talkList)}function r(t){t.status==1&&(n.totalCount=t.totalCount)}n.pageChanged=function(){var r={};r.pageIndex=n.currentPage;r.pageSize=n.pageSize;r.keyword=n.keyword;r.dataStatus=n.dataStatus;r.categoryId=n.categoryId;t.talk_items(r).then(i)};n.keywordChanged=n.categoryChanged=n.dataStatusChanged=function(){n.currentPage=1;n.refresh()};n.refresh=function(){var u={};u.pageIndex=n.currentPage;u.pageSize=n.pageSize;u.keyword=n.keyword;u.dataStatus=n.dataStatus;u.categoryId=n.categoryId;t.talk_items(u).then(i);u={};u.keyword=n.keyword;u.dataStatus=n.dataStatus;u.categoryId=n.categoryId;t.talk_count(u).then(r)};n.maxSize=10;n.currentPage=1;n.pageSize=10;n.dataStatus=0;n.categoryId=0;n.refresh()}function TalkCategoryDirective(){return{restrict:"E",template:"<span>{{talkCategory}}<\/span>",replace:!0,scope:{},link:function(n,t,i){switch(i.type){case"1":n.talkCategory="普通说说";break;case"2":n.talkCategory="技术宅";break;case"3":n.talkCategory="我写的诗";break;case"4":n.talkCategory="摘录";break;case"20":n.talkCategory="修改重发";break;case"5":n.talkCategory="待定";break;default:n.talkCategory="未定义"}}}}var route=function(n,t){t.when("","/welcome").when("/","/welcome");n.state("app",{url:"/",views:{header:{templateUrl:"/scripts/views/view_header.html"},menu:{templateUrl:"/scripts/views/view_menu.html"},"main-body":{template:"<div ui-view><div>"}}});n.state("app.welcome",{url:"welcome",templateUrl:"/scripts/views/view_welcome.html?v="+window.version});n.state("app.post",{});n.state("app.post.post-list",{url:"post-list",templateUrl:"/scripts/views/view_post_list.html?v="+window.version,controller:PostListController});n.state("app.post.post-new",{url:"post-new",templateUrl:"/scripts/views/view_post_new.html?v="+window.version,controller:PostNewController});n.state("app.post.post-edit",{url:"post-edit/:id",templateUrl:"/scripts/views/view_post_edit.html?v="+window.version,controller:PostEditController});n.state("app.talk",{});n.state("app.talk.post-list",{url:"talk-list",templateUrl:"/scripts/views/view_talk_list.html?v="+window.version,controller:TalkListController})},app=angular.module("app",["ngResource","ui.router","ui.bootstrap","ui.codemirror"]);app.config(route);app.service("BlogService",["$resource","$q",BlogService]);app.directive("talkcategory",TalkCategoryDirective);