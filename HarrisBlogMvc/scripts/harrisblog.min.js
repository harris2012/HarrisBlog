function BlogService(n,t){var i=n("",{},{post_items:{method:"POST",url:"/api/post/items"},post_count:{method:"POST",url:"/api/post/count"},post_item:{method:"POST",url:"/api/post/item"},post_create:{method:"POST",url:"/api/post/create"},post_delete:{method:"POST",url:"/api/post/delete"}});return{post_items:function(n){var r=t.defer();return i.post_items({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_count:function(n){var r=t.defer();return i.post_count({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_item:function(n){var r=t.defer();return i.post_item({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_create:function(n){var r=t.defer();return i.post_create({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise},post_delete:function(n){var r=t.defer();return i.post_delete({},n,function(n){r.resolve(n)},function(n){r.reject(n)}),r.promise}}}function PostListController(n,t){function i(t){t.status==1&&(n.posts=t.posts)}function r(t){t.status==1&&(n.totalCount=t.count)}n.pageChanged=function(){var r={};r.pageIndex=n.currentPage;r.pageSize=n.pageSize;r.keyword=n.keyword;r.dataStatus=n.dataStatus;t.post_items(r).then(i)};n.keywordChanged=n.dataStatusChanged=n.mappingTypeChanged=function(){n.currentPage=1;n.refresh()};n.refresh=function(){var u={};u.pageIndex=n.currentPage;u.pageSize=n.pageSize;u.keyword=n.keyword;u.dataStatus=n.dataStatus;t.post_items(u).then(i);u={};u.keyword=n.keyword;u.dataStatus=n.dataStatus;t.post_count(u).then(r)};n.deletePostById=function(n){var i={};i.id=n;t.post_delete(i).then(post_delete_callback)};n.maxSize=10;n.currentPage=1;n.pageSize=5;n.dataStatus=0;n.refresh()}function PostNewController(n,t,i){n.editorOptions={mode:"gfm",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0};n.post={};n.post.publishTime=new Date;n.openDatePicker=function(){n.isDatePickerOpen=!0};n.refreshPublishTime=function(){n.post.publishTime=new Date};n.postBodyChanged=function(){window.searchTime!=null&&window.clearTimeout(searchTime);window.searchTime=window.setTimeout(function(){n.post.htmlBody=marked(n.post.body);n.$apply()},200)};n.create=function(){if(n.post.title==null||n.post.title.length==0){alert("填写文章标题");return}if(n.post.ename==null||n.post.title.ename==0){alert("填写文章路径");return}if(n.post.body==null||n.post.body.length==0){alert("请填写正文");return}var r={blog:n.post,version:12345};i.create(r).then(function(n){n.status==1&&t.go("app.post.post-list")})}}function PostEditController(n,t,i,r){function f(i){i.status==404?t.go("app.post.post-list"):n.post=i.blog}n.id=i.id;n.id||t.go("app.post.post-list");n.editorOptions={mode:"gfm",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0};n.postBodyChanged=function(){window.searchTime!=null&&window.clearTimeout(searchTime);window.searchTime=window.setTimeout(function(){n.post.htmlBody=marked(n.post.body);n.$apply()},200)};n.create=function(){if(n.post.title==null||n.post.title.length==0){alert("填写文章标题");return}if(n.post.ename==null||n.post.title.ename==0){alert("填写文章路径");return}if(n.post.body==null||n.post.body.length==0){alert("请填写正文");return}var t={blog:n.post,version:67890};r.update(n.id,t).then(function(n){console.log(n);n.status==1})};var u={};u.id=n.id;r.post_item(u).then(f)}var route=function(n,t){t.when("","/welcome").when("/","/welcome");n.state("app",{url:"/",views:{header:{templateUrl:"/scripts/views/view_header.html"},menu:{templateUrl:"/scripts/views/view_menu.html"},"main-body":{template:"<div ui-view><div>"}}});n.state("app.welcome",{url:"welcome",templateUrl:"/scripts/views/view_welcome.html?v="+window.version});n.state("app.post",{});n.state("app.post.post-list",{url:"post-list",templateUrl:"/scripts/views/view_post_list.html?v="+window.version,controller:PostListController});n.state("app.post.post-new",{url:"post-new",templateUrl:"/scripts/views/view_post_new.html?v="+window.version,controller:PostNewController});n.state("app.post.post-edit",{url:"post-edit/:id",templateUrl:"/scripts/views/view_post_edit.html?v="+window.version,controller:PostEditController})},app=angular.module("app",["ngResource","ui.router","ui.bootstrap","ui.codemirror"]);app.config(route);app.service("BlogService",["$resource","$q",BlogService]);